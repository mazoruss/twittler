<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <button class='refresh'>Refresh</button>
    <div class='content'>
    <script>

      var $body = $('.content');

      $(document).ready(function(){
        refreshPage();
        $('.refresh').on('click', refreshPage);     
      });

      var refreshPage =function() {
        //clear body
        $body.html('');
        
        //iterate through streams for tweets
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          createEntry(tweet);
          index -= 1;
        }

        $('.refresh').text('Refresh');
        //make sure CSS is applied
        createStyle();
      }

      var showUserHist = function() {
        //clear body
        $body.html('');

        var username = $(this).text();
        console.log(username);

        //iterate through streams for tweets
        var index = streams.users[username].length - 1;
        while(index >= 0){
          var tweet = streams.users[username][index];
          createEntry(tweet);
          index -= 1;
        }

        $('.refresh').text('Show All');
        
        //make sure CSS is applied
        createStyle();
      }

      //do this for each tweet
      var createEntry = function(tweet) {
        //make a div for each tweet
        var $tweet = $('<div class="tweet"></div>');

        //display username
        var $user = $('<span class="user"><a></a></span>');
        $user.text(tweet.user);
        $user.appendTo($tweet);
        
        //display timestamp
        var $time = $('<span class="time"></span>');
        $time.text(tweet.created_at.toLocaleDateString() +" "+ tweet.created_at.toLocaleTimeString());
        $time.appendTo($tweet);

        //display message
        var $message = $('<p class="message"></p>');
        $message.text(tweet.message);
        $message.appendTo($tweet);
        
        //add to the body
        $tweet.appendTo($body);
        
      }

      //CSS for everything
      var createStyle = function() {
        $('.content').css('background-color', 'lightcyan');
        $('.content').css('padding', '15px');
        $('body').css('line-height', '0');
        $('.tweet').css(tweetCSS);
        $('.user').css(spacingCSS);
        $('.user').css("float", 'left');
        $('.user').css("font-weight", 'bold');
        $('.time').css(spacingCSS);
        $('.time').css("float", 'right');
        $('.message').css("clear", 'both');
        $('.message').css(spacingCSS);
        $('.message').css("padding", '15px 0px 10px 0px');

        //add the click-on-username feathre
        $('.user').on('click', showUserHist); 
      }

            //CSS for each tweet
      var tweetCSS = {
        margin: '5px',
        padding: '8px 10px 8px 10px',
        'background-color': 'white'
      }

      //CSS for individual elements
      var spacingCSS = {
          margin: '0px',
          border: '5px 0px',
          padding: '5px 0px',
      }

    </script>
    </div>
  </body>
</html>
